From 7e330a878fb7280b490cb713d1e1e04df6d507d8 Mon Sep 17 00:00:00 2001
From: Tim Lunn <tim@feathertop.org>
Date: Fri, 15 Sep 2023 12:43:01 +1000
Subject: [PATCH] OPTEE for RV1126

---
 arch/arm/mach-rockchip/Kconfig   | 4 +++-
 configs/neu2-io-rv1126_defconfig | 4 ++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/arm/mach-rockchip/Kconfig b/arch/arm/mach-rockchip/Kconfig
index bba332098f..39cee24fce 100644
--- a/arch/arm/mach-rockchip/Kconfig
+++ b/arch/arm/mach-rockchip/Kconfig
@@ -338,6 +338,7 @@ config ROCKCHIP_RV1108
 config ROCKCHIP_RV1126
 	bool "Support Rockchip RV1126"
 	select CPU_V7A
+	select HAS_ROM
 	select SKIP_LOWLEVEL_INIT_ONLY
 	select TPL
 	select SUPPORT_TPL
@@ -377,6 +378,7 @@ config ROCKCHIP_RV1126
 	imply SPL_RAM
 	imply SPL_REGMAP
 	imply SPL_ROCKCHIP_COMMON_BOARD
+	select SPL_OPTEE_IMAGE if SPL_FIT
 	imply SPL_SERIAL
 	imply SPL_SYSCON
 
@@ -451,7 +453,7 @@ config ROCKCHIP_BOOT_MODE_REG
 config ROCKCHIP_OPTEE_BINARY
 	bool "Use a OP-TEE binary provided by Rockchip"
 	depends on SPL_OPTEE_IMAGE
-	default y if ROCKCHIP_RK3036 || ROCKCHIP_RK3128 || ROCKCHIP_RK3288
+	default y if ROCKCHIP_RV1126
 	help
 	  This option enables the usage of vendor-provided OP-TEE binaries.
 	  Say Y if you are using OP-TEE binary provided by Rockchip.
diff --git a/configs/neu2-io-rv1126_defconfig b/configs/neu2-io-rv1126_defconfig
index f02c38c566..6ef1dd1bf5 100644
--- a/configs/neu2-io-rv1126_defconfig
+++ b/configs/neu2-io-rv1126_defconfig
@@ -14,6 +14,10 @@ CONFIG_DEBUG_UART_CLOCK=24000000
 CONFIG_SYS_LOAD_ADDR=0xe00800
 CONFIG_DEBUG_UART=y
 CONFIG_FIT_VERBOSE=y
+CONFIG_ROCKCHIP_OPTEE_BINARY=y
+CONFIG_SPL_FIT=y
+CONFIG_SPL_LOAD_FIT=y
+# CONFIG_USE_SPL_FIT_GENERATOR is not set
 CONFIG_DEFAULT_FDT_FILE="rv1126-edgeble-neu2-io.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
-- 
2.39.2

